<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>v02_Disproportionality_Analysis • DiAna</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="v02_Disproportionality_Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DiAna</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v01_Start_Subproject.html">v01_Start_Subproject</a></li>
    <li><a class="dropdown-item" href="../articles/v02_Disproportionality_Analysis.html">v02_Disproportionality_Analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/fusarolimichele/DiAna_package/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>v02_Disproportionality_Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/fusarolimichele/DiAna_package/blob/main/vignettes/articles/v02_Disproportionality_Analysis.Rmd" class="external-link"><code>vignettes/articles/v02_Disproportionality_Analysis.Rmd</code></a></small>
      <div class="d-none name"><code>v02_Disproportionality_Analysis.Rmd</code></div>
    </div>

    
    
<p>This tutorial will show you how to perform simple and advanced
disproportionality analyses. While this tutorial recursively redefine
the object of study and the background reference group, it does so to
provide a pedagogical flow. It is recommended to design the analysis a
priori, and clearly document and justify any deviation from the original
design.</p>
<div class="section level2">
<h2 id="requisites">Requisites<a class="anchor" aria-label="anchor" href="#requisites"></a>
</h2>
<p>This tutorial requires that you have first:</p>
<ol style="list-style-type: decimal">
<li><p>installed R and R Studio,</p></li>
<li><p>installed the DiAna package,</p></li>
<li><p>and set up your project folder.</p></li>
</ol>
<p>Otherwise get back to the ReadMe and follow the instructions.</p>
<p>It is also recommended, but not necessary, that you have read the
previous vignettes.</p>
</div>
<div class="section level2">
<h2 id="start-the-subproject">Start the subproject<a class="anchor" aria-label="anchor" href="#start-the-subproject"></a>
</h2>
<p>From the DiAna main project, we open a new R script and run the
snippet ‘new_FAERS_project’ to set up a project.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Information -----------------------------------------------------------------</span></span>
<span><span class="co">## Project title --------------------------------------------------------------</span></span>
<span><span class="co">### v02_Disproportionality analysis</span></span>
<span><span class="co">## Data -----------------------------------------------------------------------</span></span>
<span><span class="co">### FDA Adverse Event Reporting System Quarterly Data</span></span>
<span></span>
<span><span class="co">## Authors --------------------------------------------------------------------</span></span>
<span><span class="co">### Michele Fusaroli</span></span>
<span></span>
<span><span class="co">## Version --------------------------------------------------------------------</span></span>
<span><span class="co">### Set up: 2024-07-29</span></span>
<span><span class="co">### Last update: 2024-07-29</span></span>
<span><span class="co">### DiAna version: 2.1.0</span></span>
<span></span>
<span><span class="co"># Set up ----------------------------------------------------------------------</span></span>
<span><span class="co">## upload DiAna ---------------------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/fusarolimichele/DiAna_package" class="external-link">DiAna</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: data.table</span></span>
<span><span class="co">#&gt; data.table 1.15.4 using 1 threads (see ?getDTthreads).  Latest news: r-datatable.com</span></span>
<span><span class="co">#&gt; **********</span></span>
<span><span class="co">#&gt; This installation of data.table has not detected OpenMP support. It should still work but in single-threaded mode.</span></span>
<span><span class="co">#&gt; This is a Mac. Please read https://mac.r-project.org/openmp/. Please engage with Apple and ask them for support. Check r-datatable.com for updates, and our Mac instructions here: https://github.com/Rdatatable/data.table/wiki/Installation. After several years of many reports of installation problems on Mac, it's time to gingerly point out that there have been no similar problems on Windows or Linux.</span></span>
<span><span class="co">#&gt; **********</span></span>
<span><span class="co">#&gt; Loading required package: ggplot2</span></span>
<span><span class="co">#&gt; Welcome to DiAna package. A tool for standardized, flexible, and transparent pharmacovigilance analyses on the FAERS.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To cite this package in your work and publications use: Fusaroli M., Giunchi V. - DiAna version 2.1.0 (2024-08-13). An open access toolkit for DIsproportionality ANAlysis and other pharmacovigilance investigations in the FAERS. https://github.com/fusarolimichele/DiAna_package; https://github.com/fusarolimichele/DiAna; https://osf.io/zqu89/.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; DiAna contributors for specific functions were: Zoffoli V. for helping developing the cleaning procedure for the FAERS, Van Holle L. for time to onset analysis (cfr. https://doi.org/10.1002/pds.3226), Sakai T. and Trinh N. for pregnancy algorithm (cfr. 10.3389/fphar.2022.1063625)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Additional reference: Fusaroli M, Giunchi V, Battini V, Puligheddu S, Khouri C, Carnovale C, Raschi E, Poluzzi E. Enhancing Transparency in Defining Studied Drugs: The Open-Source Living DiAna Dictionary for Standardizing Drug Names in the FAERS. Drug Saf. 2024 Mar;47(3):271-284. doi: 10.1007/s40264-023-01391-4.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The MedDRA version used is 26.1</span></span>
<span></span>
<span><span class="co">## Project_path ---------------------------------------------------------------</span></span>
<span><span class="va">DiAna_path</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">project_name</span> <span class="op">&lt;-</span> <span class="st">"v02_Disproportionality_Analysis"</span></span>
<span><span class="va">project_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DiAna_path</span>, <span class="st">"/projects/"</span>, <span class="va">project_name</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">project_path</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">project_path</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">project_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">project_path</span>, <span class="st">"/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## FAERS_version --------------------------------------------------------------</span></span>
<span></span>
<span><span class="va">FAERS_version</span> <span class="op">&lt;-</span> <span class="st">"24Q1"</span></span>
<span></span>
<span><span class="co">## Import data ----------------------------------------------------------------</span></span>
<span><span class="fu"><a href="../reference/import.html">import</a></span><span class="op">(</span><span class="st">"DRUG"</span><span class="op">)</span></span>
<span><span class="co">#&gt;           primaryid   drug_seq       substance role_cod</span></span>
<span><span class="co">#&gt;               &lt;num&gt;      &lt;int&gt;          &lt;fctr&gt;    &lt;ord&gt;</span></span>
<span><span class="co">#&gt;        1:   4261825 1004486228        atropine        C</span></span>
<span><span class="co">#&gt;        2:   4261825 1004486228   diphenoxylate        C</span></span>
<span><span class="co">#&gt;        3:   4262057 1004487206     amoxicillin       PS</span></span>
<span><span class="co">#&gt;        4:   4262057 1004487206 clavulanic acid       PS</span></span>
<span><span class="co">#&gt;        5:   4262057 1004487210        macrogol        C</span></span>
<span><span class="co">#&gt;       ---                                              </span></span>
<span><span class="co">#&gt; 69763501: 992001227        580      loratadine       SS</span></span>
<span><span class="co">#&gt; 69763502: 992001227        581      loratadine       SS</span></span>
<span><span class="co">#&gt; 69763503: 992001227        582      loratadine       SS</span></span>
<span><span class="co">#&gt; 69763504: 992001227        586       magnesium        C</span></span>
<span><span class="co">#&gt; 69763505: 992001227        587       magnesium        C</span></span>
<span><span class="fu"><a href="../reference/import.html">import</a></span><span class="op">(</span><span class="st">"REAC"</span><span class="op">)</span></span>
<span><span class="co">#&gt;           primaryid                            pt drug_rec_act</span></span>
<span><span class="co">#&gt;               &lt;num&gt;                         &lt;ord&gt;        &lt;ord&gt;</span></span>
<span><span class="co">#&gt;        1:   4204616                abdominal pain         &lt;NA&gt;</span></span>
<span><span class="co">#&gt;        2:   4204616          heart rate increased         &lt;NA&gt;</span></span>
<span><span class="co">#&gt;        3:   4204616                        nausea         &lt;NA&gt;</span></span>
<span><span class="co">#&gt;        4:   4204616                       pyrexia         &lt;NA&gt;</span></span>
<span><span class="co">#&gt;        5:   4204616            uterine tenderness         &lt;NA&gt;</span></span>
<span><span class="co">#&gt;       ---                                                     </span></span>
<span><span class="co">#&gt; 52222720: 237079291         chemical burn of skin         &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 52222721: 237079291    toxicity to various agents         &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 52222722: 237079291                          scar         &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 52222723: 237203351 injection site discolouration         &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 52222724: 237203351       injection site bruising         &lt;NA&gt;</span></span>
<span></span>
<span><span class="co">## Input files ----------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## Output files ---------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## Definitions ----------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## Reference groups -----------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## Descriptive analysis -------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## Disproportionality analysis ------------------------------------------------</span></span>
<span></span>
<span><span class="co">## Case by case analysis ------------------------------------------------------</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="disproportionality-analysis">Disproportionality analysis<a class="anchor" aria-label="anchor" href="#disproportionality-analysis"></a>
</h2>
<div class="section level4">
<h4 id="basic-application">Basic application<a class="anchor" aria-label="anchor" href="#basic-application"></a>
</h4>
<p>Let’s explore the disproportionality_analysis function. We are
investigating the possibility of a role of “aripiprazole” in causing
“impulse control disorder”, and we therefore draft the definitions of
our objects of study.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Definitions --------------------------------------------------------------------------</span></span>
<span><span class="va">drug_selected</span> <span class="op">&lt;-</span> <span class="st">"aripiprazole"</span></span>
<span><span class="va">reac_selected</span> <span class="op">&lt;-</span> <span class="st">"impulse control disorder"</span></span></code></pre></div>
<p>Already using these simple definitions, we can ran the simplest
disproportionality analysis: we want to save in an object called
disproportionality_df, the results of a disproportionality analysis on
the drug and reaction specified.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Disproportionality analysis ----------------------------------------------------------</span></span>
<span><span class="va">disproportionality_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/disproportionality_analysis.html">disproportionality_analysis</a></span><span class="op">(</span></span>
<span>  drug_selected <span class="op">=</span> <span class="va">drug_selected</span>,</span>
<span>  reac_selected <span class="op">=</span> <span class="va">reac_selected</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>As you run the command a message appears in the console: “Not all the
events selected were found in the database, check the following terms
for any misspelling or alternative nomenclature: impulse control
disorder. Would you like to revise the query? (Yes/no/cancel)”. This
message implies that the exact term “impulse control disorder” does not
exists in our database. How can we proceed? We write “Yes” in the
console and run the command with “return”. The function warns us once
again to revise our query, or definition of the object of study. How can
we check the correct spelling? We can look into the MedDRA if we have
it, or more quickly search directly in the database with the following
command, that could be run just in the console since we do not need to
keep it in our script.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Reac</span><span class="op">[</span>, <span class="va">.N</span>, by <span class="op">=</span> <span class="st">"pt"</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">N</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"impuls"</span>, <span class="va">pt</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;                          pt     N</span></span>
<span><span class="co">#&gt;                       &lt;ord&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:      impulsive behaviour  3264</span></span>
<span><span class="co">#&gt; 2: impulse-control disorder  1733</span></span></code></pre></div>
<p>The previous command can be read as: “within the database Reac, count
how many times (.N) each preferred term occurs (by=”pt”). Then order the
pt by decreasing N (order(-N)). Finally, filter only the rows with the
pattern “impuls” in the pt. As you can see there are two terms that we
should plausibly include in out analysis: impulsive behaviour, which is
the term most used even if we did not even consider it, and
“impulse-control disorder” which is the term we wanted to consider but
has also a dash between the first two words. First, let’s fix the
definition. We get back to the definition section of our script and we
fix it including the dash in the reaction pt as follows and we rerun the
disproportionality analysis:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Definitions --------------------------------------------------------------------------</span></span>
<span><span class="va">drug_selected</span> <span class="op">&lt;-</span> <span class="st">"aripiprazole"</span></span>
<span><span class="va">reac_selected</span> <span class="op">&lt;-</span> <span class="st">"impulse-control disorder"</span></span>
<span></span>
<span><span class="co">## Disproportionality analysis ----------------------------------------------------------</span></span>
<span><span class="va">disproportionality_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/disproportionality_analysis.html">disproportionality_analysis</a></span><span class="op">(</span></span>
<span>  drug_selected <span class="op">=</span> <span class="va">drug_selected</span>,</span>
<span>  reac_selected <span class="op">=</span> <span class="va">reac_selected</span></span>
<span><span class="op">)</span></span>
<span><span class="va">disproportionality_df</span></span>
<span><span class="co">#&gt;       substance                    event   D_E   D_nE      D  nD_E     E    nD_nE ROR_median ROR_lower ROR_upper</span></span>
<span><span class="co">#&gt;          &lt;fctr&gt;                    &lt;ord&gt; &lt;num&gt;  &lt;num&gt;  &lt;num&gt; &lt;num&gt; &lt;num&gt;    &lt;num&gt;      &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: aripiprazole impulse-control disorder   286 111261 111547  1447  1733 17485485      31.06     27.28     35.25</span></span>
<span><span class="co">#&gt;    IC_median IC_lower IC_upper                 label_ROR               label_IC Bonferroni ROR_signal IC_signal</span></span>
<span><span class="co">#&gt;        &lt;num&gt;    &lt;num&gt;    &lt;num&gt;                    &lt;char&gt;                 &lt;char&gt;     &lt;lgcl&gt;      &lt;ord&gt;     &lt;ord&gt;</span></span>
<span><span class="co">#&gt; 1:      4.64     4.44     4.78 31.06 (27.28-35.25) [286] 4.64 (4.44-4.78) [286]       TRUE        SDR       SDR</span></span></code></pre></div>
<p>This time no error appears, and after few seconds we can see that our
environment (window pane usually on the upper right) has been populated
with a dataset called disproportionalitY_df. Calling the name of the
object prints it in the console, and we can see that the object is now a
dataset with one row (per drug-event combination) and 19 columns,
including the name of the substance and the event, the instances of the
contingency table, the median and 95% confidence interval of the
Reporting Odds Ratio ROR and of the Information component, these same
results summarised as a string in the following format “median (lower
limit-upper limit) [N cases]”. A Bonferroni column that specifies
whether the ROR was still significant after correcting for multiple
comparison, and two columns that summarise whether a signal exists (SDR)
or not (no SDR) or exists but disappear at the correction for multiple
comparison (weak SDR). In this case we have found a signal of
disproportionate reporting using both the analyses. These columns exist
to simplify input to further functions, such as, for example, the
visualization using render_forest.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/render_forest.html">render_forest</a></span><span class="op">(</span><span class="va">disproportionality_df</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figure/render_forest-1.png" alt="plot of chunk render_forest"><div class="figcaption">plot of chunk render_forest</div>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/render_forest.html">render_forest</a></span><span class="op">(</span><span class="va">disproportionality_df</span>, index <span class="op">=</span> <span class="st">"ROR"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figure/render_forest-2.png" alt="plot of chunk render_forest"><div class="figcaption">plot of chunk render_forest</div>
</div>
<pre><code><span><span class="co">#&gt; Error in knitr::include_graphics("figure/render_forest-1.png", dpi = 144): Cannot find the file(s): "figure/render_forest-1.png"</span></span>
<span><span class="co">#&gt; Error in knitr::include_graphics("render_forest-2.png", dpi = 144): Cannot find the file(s): "render_forest-2.png"</span></span></code></pre>
<p>In these forest plots we see on the x axis the information component
(by default) or the ROR if we specify it in the index parameter. The
median is shown using the dot, whose size is proportional to the number
of cases. The 95% confidence interval is shown by the line. A dashed
vertical axis (on the 0 for the IC and on the 1 for the ROR) highlights
the threshold of statistical significance, compared to which the lower
limit of the confidence interval must be higher to identify a signal of
disproportionate reporting. In this case, we identified a clear signal
of disproportionate reporting using both methods.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michele Fusaroli, Valentina Giunchi.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
